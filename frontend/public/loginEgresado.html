<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assets/css/login.css">
    <link rel="stylesheet" href="./assets/css/header.css">
    
    <title>Registro Egresado</title>

    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</head>
<body>
    <header class="header">
        <div class="logo">
            <a href="index.html"><img src="./assets/logo.png" alt="Logo"></a> 
        </div>
        <nav>
            <div class="menu-toggle" onclick="toggleMenu()">Menú</div>
            <ul class="nav-links" id="nav-links">
                <li><a href="carreras.html">Carreras</a></li>
            </ul>
        </nav>
        <div class="btn-wrapper">
            <a class="btn" href="index.html"><button>Iniciar sesión</button></a>
        </div>
    </header>
    <br>
    <br>

    <div class="container" id="container">  
        <div class="steps">
            <div id="step1Status" class="step completed">
                <ion-icon name="person-add-outline"></ion-icon>
                <p>Registro</p>
            </div>
            <div id="step2Status" class="step">
                <ion-icon name="shield-checkmark-outline"></ion-icon>
                <p>Verificación</p>
            </div>
            <div id="step3Status" class="step">
                <ion-icon name="checkmark-circle-outline"></ion-icon>
                <p>Cuenta creada</p>
            </div>
        </div>
    
        <div id="step1">
            <form id="registerForm">
                <h1>Crea tu cuenta</h1>
                <input type="text" name="firstName" placeholder="Nombres">
                <input type="text" name="lastName" placeholder="Apellidos">
                <select class="form-select form-select-sm" aria-label="Small select example">
                    <option selected>Selecciona tu carrera</option>
                    <option value="1">Ingeniería en Sistemas Computacionales</option>
                    <option value="2">Licenciatura en Ciencia de Datos</option>
                    <option value="3">Ingeniería en Inteligencia Artificial</option>
                  </select>
                  
                <input type="email" name="correo" placeholder="Email">
                <input type="password" name="password" placeholder="Password">
                <button type="submit">Registrar</button>
            </form>
            <div class="btn-wrapper">
                <a class="btn" href="index.html"><button>Regresar</button></a>
            </div>
        </div>
        <!-- Paso 2 -->
        <div style="display: none;"  id="step2">
            <div>
                <form action="#" method="POST">
                    <h1>Verificación de Identidad ESCOM</h1>
                    <input type="text" name="qr" placeholder="Pega el enlace de tu código QR">
                    <button type="button" id="scanButton">Verificar</button>

                    <p>También puedes presionar el botón para activar la cámara y luego iniciar el escaneo.</p>
                    <button>Escanear</button>
                </form>
                <div class="btn-wrapper">
                    <a class="btn" href="loginEgresado.html"><button>Regresar</button></a>
                </div>
            </div>
        </div>
    </div>
    <script>
document.addEventListener("DOMContentLoaded", () => {
    const steps = ["step1", "step2"];
    let currentStepIndex = 0;

    // Mapeo de carreras
    const carrerasMap = {
        "1": "INGENIERÍA EN SISTEMAS COMPUTACIONALES",
        "2": "Licenciatura en Ciencia de Datos",
        "3": "Ingeniería en Inteligencia Artificial",
    };

    // Elementos del DOM
    const registerForm = document.querySelector("#registerForm");
    const scanButton = document.querySelector("#scanButton");
    const qrInput = document.querySelector("input[name='qr']");
    const carreraSelect = document.querySelector(".form-select");

    // Contenedores de pasos
    const stepContainers = steps.map(id => document.getElementById(id));
    const stepStatuses = steps.map(id => document.getElementById(`${id}Status`));

    // Función para actualizar visibilidad y estado de pasos
    function updateStepVisibility() {
        stepContainers.forEach((container, index) => {
            container.style.display = index === currentStepIndex ? "block" : "none";
        });

        stepStatuses.forEach((status, index) => {
            if (index < currentStepIndex) {
                status.classList.remove("current");
                status.classList.add("completed");
            } else if (index === currentStepIndex) {
                status.classList.remove("completed");
                status.classList.add("current");
            } else {
                status.classList.remove("completed", "current");
            }
        });
    }

    // Validación del paso 1
    function validateStep1() {
        const firstName = document.querySelector("input[name='firstName']").value.trim();
        const lastName = document.querySelector("input[name='lastName']").value.trim();
        const email = document.querySelector("input[name='correo']").value.trim();
        const password = document.querySelector("input[name='password']").value.trim();
        const carrera = carreraSelect.value;

        if (!firstName || !lastName || !email || !password || carrera === "Selecciona tu carrera") {
            Swal.fire("Error", "Por favor, completa todos los campos.", "error");
            return false;
        }
        return true;
    }

    // Validación del paso 2
    async function validateStep2() {
        const qrLink = qrInput.value.trim();
        const selectedCarrera = carrerasMap[carreraSelect.value]; // Traducir valor numérico a nombre de carrera

        if (!qrLink) {
            Swal.fire("Error", "Por favor, ingresa el enlace de tu código QR.", "error");
            return false;
        }

        try {
            const response = await fetch("https://zr8f0150c8.execute-api.us-east-2.amazonaws.com/Dev", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ url: qrLink }), // Ajuste para el formato correcto
            });

            if (!response.ok) {
                throw new Error("Error al comunicarse con la API.");
            }

            const data = await response.json();

            if (data.escuela === "ESCOM" && data.carrera === selectedCarrera) {
                Swal.fire("Éxito", "Verificación completada correctamente.", "success");
                return true;
            } else {
                Swal.fire(
                    "Error",
                    `La información no coincide. Escuela: ${data.escuela}, Carrera: ${data.carrera}`,
                    "error"
                );
                return false;
            }
        } catch (error) {
            Swal.fire("Error", "Hubo un problema al comunicarse con la API.", "error");
            console.error(error);
            return false;
        }
    }

    // Eventos de pasos
    registerForm.addEventListener("submit", (e) => {
        e.preventDefault();
        if (validateStep1()) {
            document.getElementById("step1Status").classList.remove("current");
            document.getElementById("step2Status").classList.add("current");
            document.getElementById('step1').style.display = 'none'; 
            document.getElementById('step2').style.display = 'block'; 
            document.getElementById('step1Status').classList.remove('completed');
            document.getElementById('step2Status').classList.add('completed');
            currentStepIndex++;
            updateStepVisibility();
        }
    });

    scanButton.addEventListener("click", async () => {
    if (await validateStep2()) {
        document.getElementById("step2Status").classList.remove("current");
        document.getElementById("step3Status").classList.add("completed");
        currentStepIndex++;
        updateStepVisibility();
        Swal.fire("Éxito", "Cuenta creada exitosamente.", "success").then(() => {
            // Redirige después de que la alerta sea cerrada
            window.location.href = "index.html";
        });
    }
});


    // Inicializar
    updateStepVisibility();
});


    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>

</html>